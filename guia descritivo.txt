ğŸ“‹ O QUE ESSE ARQUIVO FAZ:
1. InclusÃµes e DefiniÃ§Ãµes
Inclui todas bibliotecas necessÃ¡rias

Define constantes importantes (pinos, caminhos)

2. Estruturas de Dados
UsuarioWeb: para autenticaÃ§Ã£o

EstadoCaixa: para monitoramento

3. VariÃ¡veis Globais
Credenciais WiFi

Estado do sistema

Objetos principais (server, NTP, etc.)

4. ProtÃ³tipos de FunÃ§Ã£o
Todas funÃ§Ãµes que serÃ£o implementadas em outros arquivos

5. Setup (Ordem CRÃTICA)
Serial - comunicaÃ§Ã£o debug

GPIOs - configura pinos das bombas

SPIFFS - sistema de arquivos (prioridade mÃ¡xima)

WiFi - conexÃ£o de rede

NTP - sincronizaÃ§Ã£o de hora

UsuÃ¡rios - banco de dados

Web Server - API e pÃ¡ginas web

6. Loop Principal
Monitora WiFi - reconecta se cair

Atualiza hora - periodicamente

Processa requisiÃ§Ãµes - servidor web

Simula sensores - para teste (substituir depois)

variaveis.h - Header com declaraÃ§Ãµes

variaveis.cpp - ImplementaÃ§Ã£o das variÃ¡veis

conexao.ino - WiFi e NTP

spiffs.ino - Sistema de arquivos

usuarios.ino - AutenticaÃ§Ã£o

webserver.ino - Servidor web

ğŸ¯ ESTRUTURA FINAL DOS 3 PRIMEIROS ARQUIVOS:
1. caixa_terreo.ino
FunÃ§Ã£o: Apenas setup() e loop()

ConteÃºdo: SequÃªncia de inicializaÃ§Ã£o e loop principal

NÃ£o tem: Includes, variÃ¡veis globais, implementaÃ§Ãµes

2. variaveis.h
FunÃ§Ã£o: DeclaraÃ§Ãµes (headers)

ConteÃºdo:

Todos os #include

#define constantes

Estruturas (struct)

DeclaraÃ§Ãµes extern de variÃ¡veis

ProtÃ³tipos de funÃ§Ã£o

3. variaveis.cpp
FunÃ§Ã£o: DefiniÃ§Ãµes das variÃ¡veis globais

ConteÃºdo:

Valores das constantes

InstanciaÃ§Ã£o de objetos globais

ImplementaÃ§Ãµes simples/imutÃ¡veis

usuarios.ino âœ…
InicializaÃ§Ã£o: inicializarBancoUsuarios() - verifica e conta usuÃ¡rios

AutenticaÃ§Ã£o: autenticarUsuario() - valida credenciais no arquivo

APIs CRUD:

apiListarUsuarios() - GET /api/usuarios

apiCriarUsuario() - POST /api/usuarios

apiExcluirUsuario() - DELETE /api/usuarios

Login/Logout:

processarLogin() - POST /api/login

processarLogout() - POST /api/logout

SeguranÃ§a: PermissÃµes por nÃ­vel (admin, sindico)

Registro: Todas aÃ§Ãµes geram avisos no sistema

AtualizaÃ§Ãµes:
âœ… variaveis.h - Novos protÃ³tipos apiCriarUsuario(), apiExcluirUsuario()

âœ… variaveis.cpp - Removido array USUARIOS_WEB (agora usamos SPIFFS)

âœ… Sistema completo de autenticaÃ§Ã£o baseado em arquivo



âœ… RESUMO DO QUE FOI CRIADO/ATUALIZADO:
webserver.ino âœ…
InicializaÃ§Ã£o: inicializarWebServer() - configura tudo

Rotas API: configurarRotasAPI() - todas APIs REST

Rotas estÃ¡ticas: configurarRotasEstaticas() - serve HTML/CSS/JS

CORS: Headers para desenvolvimento

404 personalizado: Tratamento de rotas nÃ£o encontradas

APIs implementadas:
âœ… /api/login - POST

âœ… /api/logout - POST

âœ… /api/usuarios - GET, POST, DELETE

âœ… /api/avisos - GET (placeholder)

âœ… /api/status - GET (info do sistema)

âœ… /api/bombas/ligar/A - POST

âœ… /api/bombas/ligar/B - POST

âœ… /api/bombas/desligar - POST

âœ… RESUMO DO QUE FOI CRIADO/ATUALIZADO:
avisos.ino âœ…
Registro: registrarAviso() - funÃ§Ã£o principal com formataÃ§Ã£o

API: apiListarAvisos() - GET /api/avisos

FunÃ§Ãµes convencionais:

registrarAvisoLogin(), registrarAvisoLoginFalha(), registrarAvisoLogout()

registrarAvisoBomba(), registrarAvisoNivelCritico(), registrarAvisoNivelNormal()

UtilitÃ¡rios: contarAvisos(), limparAvisosAntigos()

InicializaÃ§Ã£o: inicializarSistemaAvisos() - registra boot e conta avisos

bombas.ino âœ… (parcial)
Controle manual: ligarBombaA(), ligarBombaB(), desligarBombas()

Controle automÃ¡tico: controleAutomaticoBombas() - lÃ³gica simples

AtualizaÃ§Ãµes:
âœ… variaveis.h - Novo protÃ³tipo inicializarSistemaAvisos()

âœ… caixa_terreo.ino - Adicionada chamada para inicializar avisos

âœ… usuarios.ino - Atualizadas chamadas para usar funÃ§Ãµes convencionais

âœ… webserver.ino - Atualizadas chamadas para usar funÃ§Ãµes convencionais

ğŸ“Š ESTADO ATUAL DO SISTEMA:
Arquivos completos:
âœ… caixa_terreo.ino - Principal

âœ… variaveis.h - Header com todas declaraÃ§Ãµes

âœ… variaveis.cpp - VariÃ¡veis globais

âœ… conexao.ino - WiFi + NTP

âœ… spiffs.ino - Sistema de arquivos

âœ… usuarios.ino - AutenticaÃ§Ã£o + CRUD

âœ… webserver.ino - Servidor web + rotas

âœ… avisos.ino - Sistema de avisos/eventos

âœ… bombas.ino - Controle de bombas (parcial)

Funcionalidades implementadas:
âœ… Sistema de arquivos SPIFFS

âœ… WiFi + AP de fallback

âœ… NTP (tempo real)

âœ… AutenticaÃ§Ã£o com arquivo

âœ… CRUD de usuÃ¡rios

âœ… APIs REST completas

âœ… Sistema de avisos/registros

âœ… Controle manual de bombas

âœ… PÃ¡ginas web estÃ¡ticas

ğŸ¯ PRÃ“XIMO PASSOS:
Qual funcionalidade vocÃª quer implementar agora?

Completar bombas.ino com lÃ³gica automÃ¡tica avanÃ§ada

sensores.ino - Leitura real de sensores (ultrassom, vazÃ£o)

estado_caixa.ino - Gerenciamento do estado da caixa

Testar e depurar o sistema atual

Ou quer adicionar algo especÃ­fico?



âœ… RESUMO DO QUE FOI CRIADO/ATUALIZADO:
bombas.ino âœ… COMPLETO
Controle manual: ligarBombaA(), ligarBombaB(), desligarBombas(), ligarBombasAB()

Controle automÃ¡tico: controleAutomaticoBombas() - lÃ³gica completa

SeguranÃ§a: verificarSegurancaBombas() - proteÃ§Ãµes

InicializaÃ§Ã£o: inicializarControleBombas() - setup

UtilitÃ¡rios: statusBombas(), resetTempoBombas()

CaracterÃ­sticas implementadas:
âœ… Tempo mÃ¡ximo (5 minutos) - proteÃ§Ã£o contra superaquecimento

âœ… Tempo mÃ­nimo (30 segundos) - proteÃ§Ã£o contra ciclagem rÃ¡pida

âœ… AlternÃ¢ncia automÃ¡tica entre bombas (2 minutos)

âœ… LÃ³gica automÃ¡tica baseada em nÃ­vel da caixa

âœ… ProteÃ§Ã£o contra ambas bombas ligadas sem necessidade

âœ… Modo emergÃªncia (ligar ambas)

AtualizaÃ§Ãµes:
âœ… variaveis.h - Novos protÃ³tipos e definiÃ§Ãµes de bombas

âœ… variaveis.cpp - VariÃ¡veis de controle de tempo das bombas

âœ… caixa_terreo.ino - Adicionadas chamadas no setup e loop

ğŸ“ INFORMAÃ‡ÃƒO GUARDADA:
sensores.ino â†’ apenas declaraÃ§Ãµes â†’ vai para variaveis.h/cpp

Funcionalidades separadas: ultrassom.ino, vazao.ino, leds.ino, chaves.ino

ğŸ¯ PRÃ“XIMO PASSO:
Agora com bombas completas, qual vocÃª prefere?

estado_caixa.ino - Gerenciamento do estado da caixa (lÃ³gica central)

Adicionar sensores em variaveis.h/cpp - DeclaraÃ§Ãµes de pinos/variÃ¡veis

ultrassom.ino - Leitura do sensor de nÃ­vel (HC-SR04 ou similar)

Recomendo estado_caixa.ino para criar a lÃ³gica central antes dos sensores especÃ­ficos.



ğŸ“‹ CHECKLIST DE CONSISTÃŠNCIA:
âœ… Todas as marcaÃ§Ãµes agora estÃ£o consistentes:
[USADO EM: arquivo - linha X] - formato padrÃ£o

Sem marcaÃ§Ãµes duplicadas

Todas as funÃ§Ãµes implementadas tÃªm suas referÃªncias

Todas as variÃ¡veis tÃªm suas referÃªncias de uso

âœ… Arquivos atualizados com marcaÃ§Ãµes corretas:
âœ… variaveis.h - MARCAÃ‡Ã•ES COMPLETAS E CONSISTENTES

âœ… variaveis.cpp - COMPLETO

âœ… bombas.ino - JÃ TEMOS (completo)

âœ… usuarios.ino - JÃ TEMOS (atualizado)

âœ… webserver.ino - JÃ TEMOS (atualizado)

âœ… avisos.ino - JÃ TEMOS

âœ… conexao.ino - JÃ TEMOS

âœ… spiffs.ino - JÃ TEMOS

âœ… caixa_terreo.ino - JÃ TEMOS

âœ… ultrassom.ino - Sensor de nÃ­vel REAL

âœ… Sistema ainda funciona em modo simulaÃ§Ã£o (loop antigo)

âœ… Podemos testar com sensor real quando quiser

